<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>D3 16</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link href="css/nv.d3.css" rel="stylesheet">

  <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="js/stream_layers.js"></script>
  <script type="text/javascript" src="js/d3.js"></script>
  <script type="text/javascript" src="js/nv.d3.js"></script>
  <script type="text/javascript" src="js/nvx.d3.js"></script>
</head>
<body>

<style>
  #chart1 svg {
    height: 350px;
    width: 600px;
  }

  #chart2 svg {
    height: 350px;
    width: 600px;
  }
</style>

<div id="chart1">
  <svg></svg>
</div>
<div id="chart2">
  <svg></svg>
</div>

<script type="text/javascript">

  d3.json("data1.json", function (error, data) {
    console.log(error);
    console.log(data);

    nv.addGraph(function () {
      var chart = nv.models.multiLineChart()
          .margin({top: 30, right: 60, bottom: 50, left: 70})
          .x(function (d, i) {
            return i
          })
          .y(function (d) {
            return d[1]
          })
          .color(d3.scale.category10().range());

      chart.xAxis
          .showMaxMin(false)
          .tickFormat(function (d) {
            var dx = data[0].values[d] && data[0].values[d][0] || 0;
            return d3.time.format('%x')(new Date(dx))
          });

      chart.y1Axis
          .tickFormat(d3.format(',f'));

      chart.y2Axis
          .tickFormat(function (d) {
            return '$' + d3.format(',f')(d)
          });

      //chart.bars.forceY([0]);

      d3.select('#chart1 svg')
          .datum(data)
          .transition()
          .duration(500)
          .call(chart);

      nv.utils.windowResize(chart.update);

      return chart;
    });
  });

  var testdata = stream_layers(2, 10 + Math.random() * 100, .1).map(function (data, i) {
    return {
      key: 'Stream' + i,
      values: data.map(function (a) {
        a.y = a.y * (i <= 1 ? -1 : 1);
        return a
      })
    };
  });

  testdata[0].type = "line"
  testdata[0].yAxis = 1
  testdata[1].type = "line"
  testdata[1].yAxis = 2

  nv.addGraph(function () {
    var chart = nv.models.multiChart()
        .margin({top: 30, right: 60, bottom: 50, left: 70})
        .color(d3.scale.category10().range());

    chart.xAxis
        .tickFormat(d3.format(',f'));

    chart.yAxis1
        .tickFormat(d3.format(',.1f'));

    chart.yAxis2
        .tickFormat(d3.format(',.1f'));

    d3.select('#chart2 svg')
        .datum(testdata)
        .transition().duration(500).call(chart);

    return chart;
  });

</script>
</body>
</html>
